name: ğŸ” Debug API Connection

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ” Debug informaciÃ³n
      run: |
        echo "ğŸ” Debugging conexiÃ³n con la API"
        echo "ğŸ“… Fecha: $(date)"
        echo "ğŸ”— URL configurada: ${{ secrets.ALQUILERES_API_URL }}"
        
        # Verificar que el secret existe
        if [[ -z "${{ secrets.ALQUILERES_API_URL }}" ]]; then
          echo "âŒ ERROR: Secret ALQUILERES_API_URL no estÃ¡ configurado"
          echo "ğŸ”§ Configura el secret en GitHub: Settings â†’ Secrets and variables â†’ Actions"
          exit 1
        fi
        
        echo "âœ… Secret encontrado"
        
        # Probar conectividad bÃ¡sica
        echo "ğŸŒ Probando conectividad..."
        
        # Test 1: Endpoint principal
        echo "ğŸ“¡ Test 1: Endpoint principal"
        curl -v --connect-timeout 10 --max-time 30 \
          -H "User-Agent: GitHub-Debug/1.0" \
          "${{ secrets.ALQUILERES_API_URL }}/" || echo "FALLÃ“"
        
        echo -e "\n---\n"
        
        # Test 2: Health endpoint
        echo "ğŸ“¡ Test 2: Health endpoint"
        curl -v --connect-timeout 10 --max-time 30 \
          -H "User-Agent: GitHub-Debug/1.0" \
          "${{ secrets.ALQUILERES_API_URL }}/api/recurring/health" || echo "FALLÃ“"
        
        echo -e "\n---\n"
        
        # Test 3: Backup endpoint (solo headers)
        echo "ğŸ“¡ Test 3: Backup endpoint (headers)"
        curl -I --connect-timeout 10 --max-time 30 \
          -H "User-Agent: GitHub-Debug/1.0" \
          "${{ secrets.ALQUILERES_API_URL }}/api/backup" || echo "FALLÃ“"
